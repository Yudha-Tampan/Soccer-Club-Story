<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Formasi - True Football Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4">
  <div class="max-w-md mx-auto">
    <h1 class="text-2xl font-bold mb-4 text-center">Pilih Formasi</h1>

    <!-- Daftar Formasi dalam Grid -->
    <div class="space-y-3">
      <button onclick="pilihFormasi('4-4-2')" class="w-full py-3 text-lg font-mono bg-gray-800 hover:bg-blue-700 rounded-lg transition">4 - 4 - 2</button>
      <button onclick="pilihFormasi('4-3-3')" class="w-full py-3 text-lg font-mono bg-gray-800 hover:bg-blue-700 rounded-lg transition">4 - 3 - 3</button>
      <button onclick="pilihFormasi('3-5-2')" class="w-full py-3 text-lg font-mono bg-gray-800 hover:bg-blue-700 rounded-lg transition">3 - 5 - 2</button>
      <button onclick="pilihFormasi('5-3-2')" class="w-full py-3 text-lg font-mono bg-gray-800 hover:bg-blue-700 rounded-lg transition">5 - 3 - 2</button>
    </div>

    <div class="mt-6 flex gap-3">
      <button onclick="window.history.back()" class="py-2 px-4 bg-gray-700 hover:bg-gray-600 rounded">‚Üê Kembali</button>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // Fungsi bantu: hitung formasi
    function hitungFormasi(formasi) {
      const [def, mid, att] = formasi.split('-').map(Number);
      return { GK: 1, DEF: def, MID: mid, ATT: att };
    }

    // Fungsi bantu: atur starter otomatis
    function aturStarterOtomatis(skuad, formasi) {
      const kebutuhan = hitungFormasi(formasi);
      const starter = [];
      const cadangan = [...skuad];

      // 1. GK
      const gk = cadangan.find(p => p.posisi === "GK");
      if (gk) {
        gk.starter = true;
        starter.push(gk);
        cadangan.splice(cadangan.indexOf(gk), 1);
      }

      // 2. Defender
      const defenders = cadangan.filter(p => 
        ["CB", "RB", "LB", "WB"].includes(p.posisi)
      ).sort((a, b) => b.ovr - a.ovr);
      for (let i = 0; i < kebutuhan.DEF && defenders.length > 0; i++) {
        const p = defenders.shift();
        p.starter = true;
        starter.push(p);
        cadangan.splice(cadangan.findIndex(x => x === p), 1);
      }

      // 3. Midfielder
      const midfielders = cadangan.filter(p => 
        ["CM", "DM", "AM", "RW", "LW", "WM"].includes(p.posisi)
      ).sort((a, b) => b.ovr - a.ovr);
      for (let i = 0; i < kebutuhan.MID && midfielders.length > 0; i++) {
        const p = midfielders.shift();
        p.starter = true;
        starter.push(p);
        cadangan.splice(cadangan.findIndex(x => x === p), 1);
      }

      // 4. Attacker
      const attackers = cadangan.filter(p => 
        ["ST", "CF", "WF"].includes(p.posisi)
      ).sort((a, b) => b.ovr - a.ovr);
      for (let i = 0; i < kebutuhan.ATT && attackers.length > 0; i++) {
        const p = attackers.shift();
        p.starter = true;
        starter.push(p);
        cadangan.splice(cadangan.findIndex(x => x === p), 1);
      }

      // 5. Isi sisa dengan pemain terbaik
      while (starter.length < 11 && cadangan.length > 0) {
        const p = cadangan.reduce((max, pemain) => pemain.ovr > max.ovr ? pemain : max);
        p.starter = true;
        starter.push(p);
        cadangan.splice(cadangan.findIndex(x => x === p), 1);
      }

      // 6. Sisanya jadi cadangan
      cadangan.forEach(p => p.starter = false);
      return [...starter, ...cadangan];
    }

    function pilihFormasi(formasi) {
      const game = muatGame();
      if (!game) return;

      game.formasi = formasi;
      game.skuad = aturStarterOtomatis(game.skuad, formasi);
      simpanGame(game);
      alert(`Formasi diubah ke ${formasi}`);
      window.history.back();
    }
  </script>
</body>
</html>